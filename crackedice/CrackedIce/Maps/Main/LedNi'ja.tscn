[gd_scene load_steps=39 format=4 uid="uid://dpdiwf4xpmo4h"]

[ext_resource type="PackedScene" uid="uid://po1b2fmndqn1" path="res://CrackedIce/Art/Lightning/Enviroment/LedNi'jaEnvironment.tscn" id="1_jdeb5"]
[ext_resource type="PackedScene" uid="uid://8sl5gmdd6o6w" path="res://cars/camera/camera_3d.tscn" id="2_f30ug"]
[ext_resource type="AudioStream" uid="uid://bf2gw5y0nslln" path="res://Audio/AMB/Test/AX_GeneralAMB_Test1.ogg" id="2_fnjlq"]
[ext_resource type="PackedScene" uid="uid://cvuokl6pvc3k" path="res://CrackedIce/Entities/Player/PlayerController.tscn" id="3_7sj46"]
[ext_resource type="Material" uid="uid://o2c3hgltivyn" path="res://CrackedIce/MaterialLibrary/Nature/Metal/large_rough_iron.tres" id="3_8rihx"]
[ext_resource type="Script" path="res://CrackedIce/Menus/PauseMenu/PauseMenuController.gd" id="3_i458f"]
[ext_resource type="PackedScene" uid="uid://bg04dr8a6q71r" path="res://CrackedIce/Entities/NPC/Cars/base/torke.tscn" id="3_s8frt"]
[ext_resource type="Material" uid="uid://0xvqidkk0f8y" path="res://CrackedIce/MaterialLibrary/Nature/Elements-tiny/ice.tres" id="4_sh0mw"]
[ext_resource type="Script" path="res://CrackedIce/Art/Terrain/IcePlane.gd" id="5_1u3w2"]
[ext_resource type="PackedScene" uid="uid://c2q4nrkbr0hmu" path="res://CrackedIce/Art/VFX/VehicleSnowCPUParticles.tscn" id="5_xbtsj"]
[ext_resource type="FontFile" uid="uid://c6ucy4buw7xvx" path="res://CrackedIce/UI/Fonts/BrokenGlass.woff2" id="7_520lm"]
[ext_resource type="Script" path="res://CrackedIce/UI/Labels/vehicle_speed.gd" id="8_q4poe"]
[ext_resource type="PackedScene" uid="uid://nnf74qff1cbr" path="res://CrackedIce/UI/FX/CrackingScreen.tscn" id="8_vul67"]
[ext_resource type="PackedScene" uid="uid://dd0rubbt6wcm3" path="res://CrackedIce/UI/ProgressBar/damagebar.tscn" id="11_veoik"]
[ext_resource type="PackedScene" uid="uid://5lctwpfh4nc4" path="res://CrackedIce/UI/ProgressBar/rpmbar.tscn" id="12_um7jh"]
[ext_resource type="Shader" path="res://CrackedIce/UI/FX/psx_camera/psx_camera_shader.gdshader" id="13_a324n"]
[ext_resource type="PackedScene" uid="uid://v6mmlt5udyls" path="res://CrackedIce/Menus/FailureMenu/WreckedCarScreen.tscn" id="13_dwib2"]
[ext_resource type="FontFile" uid="uid://bnyvva6ll54kk" path="res://CrackedIce/UI/Fonts/SHATTERB.TTF" id="14_jh38w"]
[ext_resource type="PackedScene" uid="uid://ufcyde5o8pq3" path="res://CrackedIce/UI/ProgressBar/heatbar.tscn" id="14_qimxu"]
[ext_resource type="Texture2D" uid="uid://b6mslh5qmwpf6" path="res://CrackedIce/UI/Labels/snowflake_blue.png" id="14_tfebk"]
[ext_resource type="FontFile" uid="uid://c4lwpp1x5wyu8" path="res://CrackedIce/UI/Fonts/Kurland.woff2" id="15_4e5xo"]
[ext_resource type="PackedScene" uid="uid://ckymtsq1bt135" path="res://CrackedIce/UI/FX/FadeScreen.tscn" id="15_72yoj"]
[ext_resource type="PackedScene" uid="uid://40fh8ikhnbq4" path="res://CrackedIce/Entities/NPC/Cars/base/engine_sound_base.tscn" id="15_d84id"]
[ext_resource type="PackedScene" uid="uid://b0f8ptml31c6a" path="res://CrackedIce/Art/Terrain/LedNi'ja.tscn" id="15_l87dr"]
[ext_resource type="Script" path="res://CrackedIce/UI/Labels/CurrentAmbientTemp.gd" id="16_renhl"]
[ext_resource type="Texture2D" uid="uid://bm1g2qo76n7nm" path="res://CrackedIce/UI/Labels/GlobalFrost.webp" id="20_pe315"]
[ext_resource type="PackedScene" uid="uid://c8v32xdxyi5jd" path="res://CrackedIce/Menus/PauseMenu/PauseMenu.tscn" id="25_dn3bh"]
[ext_resource type="PackedScene" uid="uid://cgo7ptnp3tgne" path="res://CrackedIce/Art/Buildings/Heater.tscn" id="27_nxxk1"]

[sub_resource type="ArrayMesh" id="ArrayMesh_4sv5j"]
_surfaces = [{
"aabb": AABB(-1499.78, 0, -1125, 1999.78, 1e-05, 2250),
"attribute_data": PackedByteArray("AACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAAAAAD4d0z0AAAAAAAAAAJktYzlhHdM9AAAAABqIpj7aMGM5dI6mPgAAAABsjqY+AACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAAAAAAAAAAAAAIA/yPF/PwAAgD8AAIA/LXxjOcjxfz8AAIA/AAAAAAAAAAAAAIA/AAAAAMjxfz8AAAAAAAAAAACgYznG8X8/AAAAAAAAgD8="),
"format": 34359742487,
"index_count": 51,
"index_data": PackedByteArray("AAABAAIAAwAEAAUABQAGAAMABAACAAUAAgABAAcABQACAAcACAAGAAcABwABAAgABwAGAAUACQAKAAsACgAMAAsADQAOAA8ADwAQAA0ADgARAA8AEgATABAAFAAVABIAEgAQABQA"),
"material": ExtResource("4_sh0mw"),
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 22,
"vertex_data": PackedByteArray("AAD6QwAAAAAAoIxEAAD6wwAAAAAAoIxEAAD6QwAAAAAAoIzEAgD6wwAAAAAIRF/EAAD6wwAAAAAAoIzEOuT5wwAAAAAIRF/EAAD6wwAAAAD0lcTDOuT5wwAAAAAQiMTDAAD6wwAAAAAQiMTDRAv6wwAAAAC2W4xEogV6xAAAAAC2W4xERAv6wwAAAABou/VCogV6xAAAAABou/VCAgD6wwAAAAAIRF/EOuT5wwAAAAAIRF/EAAD6wwAAAAD0lcTDDnm7xAAAAAAIRF/EOuT5wwAAAAAQiMTDAAD6wwAAAAAQiMTDDnm7xAAAAAAQiMTDAAD6wwAAAAD0lcTDOuT5wwAAAAAQiMTDAID//////78AgP///v//vwCA///+//+/AID/////K8AAgP//////vwCA/////xXAAID/////JsAAgP////8TwACA/////yfAAID//////78AgP//////vwCA//////+/AID//////78AgP///////wCA////////AID///////8AgP///////wCA////////AID/////7/8AgP///////wCA/////+3/AID/////7f8=")
}]

[sub_resource type="ConcavePolygonShape3D" id="ConcavePolygonShape3D_tn8gs"]
data = PackedVector3Array(500, 0, 1125, -500, 0, 1125, 500, 0, -1125, -500, 0, -893.063, -500, 0, -1125, -499.783, 0, -893.063, -499.783, 0, -893.063, -500, 0, -393.171, -500, 0, -893.063, -500, 0, -1125, 500, 0, -1125, -499.783, 0, -893.063, 500, 0, -1125, -500, 0, 1125, -499.783, 0, -393.063, -499.783, 0, -893.063, 500, 0, -1125, -499.783, 0, -393.063, -500, 0, -393.063, -500, 0, -393.171, -499.783, 0, -393.063, -499.783, 0, -393.063, -500, 0, 1125, -500, 0, -393.063, -499.783, 0, -393.063, -500, 0, -393.171, -499.783, 0, -893.063, -500.088, 0, 1122.87, -1000.09, 0, 1122.87, -500.088, 0, 122.866, -1000.09, 0, 1122.87, -1000.09, 0, 122.866, -500.088, 0, 122.866, -500, 0, -893.063, -499.783, 0, -893.063, -500, 0, -393.171, -500, 0, -393.171, -1499.78, 0, -893.063, -500, 0, -893.063, -499.783, 0, -893.063, -499.783, 0, -393.063, -500, 0, -393.171, -500, 0, -393.063, -1499.78, 0, -393.063, -1499.78, 0, -893.063, -500, 0, -393.171, -499.783, 0, -393.063, -500, 0, -393.063, -500, 0, -393.063, -1499.78, 0, -893.063, -500, 0, -393.171)

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_myi1p"]
friction = 0.0
bounce = 1.0
absorbent = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rbvfy"]
render_priority = 0
shader = ExtResource("13_a324n")
shader_parameter/enable_fog = true
shader_parameter/fog_color = Color(0.81, 0.894, 0.9, 1)
shader_parameter/noise_color = Color(0.2, 0.2, 0.2, 1)
shader_parameter/fog_distance = 1024.0
shader_parameter/fog_fade_range = 1024.0
shader_parameter/enable_noise = true
shader_parameter/noise_time_fac = 4.4
shader_parameter/enable_color_limitation = true
shader_parameter/color_levels = 24
shader_parameter/enable_dithering = true
shader_parameter/dither_strength = 0.044

[sub_resource type="QuadMesh" id="QuadMesh_mrjgf"]
material = SubResource("ShaderMaterial_rbvfy")
flip_faces = true
size = Vector2(2, 2)

[sub_resource type="LabelSettings" id="LabelSettings_pjyyn"]
font = ExtResource("14_jh38w")
font_size = 40
font_color = Color(1, 1, 1, 0.607843)
outline_size = 4
outline_color = Color(0.1, 0.1, 0.1, 0.392157)

[sub_resource type="LabelSettings" id="LabelSettings_udm3l"]
font = ExtResource("15_4e5xo")
font_size = 15
font_color = Color(1, 1, 1, 0.607843)
outline_size = 4
outline_color = Color(0.1, 0.1, 0.1, 0.392157)

[sub_resource type="GDScript" id="GDScript_y0cgq"]
script/source = "extends RichTextLabel

@export var time: float = 60.0
var playing: bool = false

func _ready():
	# set timer to 1 minute
	time = 60.0

func _process(delta):

	# update timer
	if playing:
		time -= delta
		if time > 60.0 and time < 60.2:
			playing = false
			time = 60.0
		# get the unique reference for the timer as rich text label
		text = \"[center]%02d:%02d\" % [floor(time / 60), floor(fmod(time, 60))] + \"[/center]\"
	else:
		text = \"[center]press T to start[/center]\"

	if time <= 0.0:
		playing = false
		time = 0.0
		text = \"[center]00:00 press T to restart[/center]\"
	# start timer when the button \"t\" is pressed
	if Input.is_physical_key_pressed(KEY_T):
		if playing and time < 59.0 or time == 0.0:
			time = 60.5
		elif time == 60.0 and not playing:
			text = \"[center]Go![/center]\"
			time = 60.0
			playing = true
	# reload scene when the button \"r\" is pressed
"

[sub_resource type="LabelSettings" id="LabelSettings_w3t5d"]
line_spacing = 0.0
font = ExtResource("15_4e5xo")
font_size = 25
shadow_size = 4
shadow_color = Color(0.425, 0.85, 0.85, 0.172549)

[sub_resource type="LabelSettings" id="LabelSettings_xnwfa"]
line_spacing = 0.0
font = ExtResource("15_4e5xo")
font_size = 15
font_color = Color(0, 0, 0, 1)
shadow_size = 4
shadow_color = Color(0.425, 0.85, 0.85, 0.172549)

[node name="LedNi\'ja" type="Node3D"]

[node name="WorldEnvironment" parent="." instance=ExtResource("1_jdeb5")]

[node name="s_GeneralAMB" type="AudioStreamPlayer" parent="."]
stream = ExtResource("2_fnjlq")
autoplay = true

[node name="PauseMenuController" type="Node" parent="."]
process_mode = 3
script = ExtResource("3_i458f")
pause_menu_packed = ExtResource("25_dn3bh")

[node name="LedNi\'ja" parent="." instance=ExtResource("15_l87dr")]

[node name="Bridge" type="CSGBox3D" parent="LedNi\'ja"]
transform = Transform3D(0.999377, -0.00523277, -0.0348995, 0.00523596, 0.999986, 0, 0.034899, -0.000182732, 0.999391, 345.779, 51.2259, -5.91245)
material_override = ExtResource("3_8rihx")
use_collision = true
collision_layer = 2
size = Vector3(230.607, 0.5, 10)

[node name="IcePlane" type="MeshInstance3D" parent="LedNi\'ja"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 746, 44, 0)
mesh = SubResource("ArrayMesh_4sv5j")
script = ExtResource("5_1u3w2")
target_temp = -50.0

[node name="Area3D" type="Area3D" parent="LedNi\'ja/IcePlane"]
collision_layer = 2

[node name="CollisionShape3D" type="CollisionShape3D" parent="LedNi\'ja/IcePlane/Area3D"]
shape = SubResource("ConcavePolygonShape3D_tn8gs")

[node name="StaticBody3D" type="StaticBody3D" parent="LedNi\'ja/IcePlane"]
collision_layer = 2
physics_material_override = SubResource("PhysicsMaterial_myi1p")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="LedNi\'ja/IcePlane/StaticBody3D"]
shape = SubResource("ConcavePolygonShape3D_tn8gs")

[node name="PlayerController" parent="." node_paths=PackedStringArray("vehicle", "hud", "camera", "camera_target", "snow_particles", "engine_sound") instance=ExtResource("3_7sj46")]
process_mode = 3
vehicle = NodePath("Torke")
hud = NodePath("Hud")
camera = NodePath("Torke/lookat/Camera3D")
camera_target = NodePath("Torke/lookat")
snow_particles = NodePath("Torke/lookat/Camera3D/VehicleSnowCPUParticles")
engine_sound = NodePath("Torke/EngineSound")

[node name="Torke" parent="PlayerController" instance=ExtResource("3_s8frt")]
process_mode = 1
transform = Transform3D(-0.5, 0, 0.866025, 0, 1, 0, -0.866025, 0, -0.5, 55.014, 54.4311, -568.993)
steer_speed = 0.3
steer_limit = 1.2
engine_force_value = 500
throttle_speed = 1.0
gear_ratios = Array[float]([3.0, 2.4, 1.9, 1.5, 1.2, 1.0])
final_drive = 1.0
reverse_ratio = 1.5
shift_time = 0.25

[node name="lookat" type="Node3D" parent="PlayerController/Torke"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.5, 0)

[node name="Camera3D" parent="PlayerController/Torke/lookat" instance=ExtResource("2_f30ug")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 96.5755, 13.2879, -631.549)
fov = 90.0
far = 1024.0
target_distance = 4.0
target_height = 0.8
speed = 15.0

[node name="VehicleSnowCPUParticles" parent="PlayerController/Torke/lookat/Camera3D" instance=ExtResource("5_xbtsj")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 20, -45)
explosiveness = 0.05
lifetime_randomness = 0.1
particle_flag_align_y = true

[node name="PSXMesh" type="MeshInstance3D" parent="PlayerController/Torke/lookat/Camera3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.1)
mesh = SubResource("QuadMesh_mrjgf")

[node name="EngineSound" parent="PlayerController/Torke" instance=ExtResource("15_d84id")]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 0, 0, 0)
volume_db = -80.0
bus = &"SFX"
attenuation_filter_cutoff_hz = 440.0
doppler_tracking = 2

[node name="Hud" type="CanvasLayer" parent="PlayerController"]
process_mode = 1
layer = 2

[node name="BackgroundTextureRect2" parent="PlayerController/Hud" instance=ExtResource("15_72yoj")]
modulate = Color(0.9, 0.9, 0.9, 0)
z_index = 4

[node name="BackgroundTextureRect" parent="PlayerController/Hud" instance=ExtResource("8_vul67")]
modulate = Color(0.8, 0.8, 0.8, 0)

[node name="speed" type="Label" parent="PlayerController/Hud"]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -276.0
offset_top = -90.0
offset_right = -224.0
offset_bottom = -49.0
grow_horizontal = 2
grow_vertical = 0
theme_override_font_sizes/font_size = 20
text = "100"
label_settings = SubResource("LabelSettings_pjyyn")
horizontal_alignment = 1
vertical_alignment = 1
script = ExtResource("8_q4poe")

[node name="speed3" type="Label" parent="PlayerController/Hud"]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -227.0
offset_top = -72.0
offset_right = -197.0
offset_bottom = -52.0
grow_horizontal = 2
grow_vertical = 0
theme_override_font_sizes/font_size = 20
text = "kpm"
label_settings = SubResource("LabelSettings_udm3l")
horizontal_alignment = 1
vertical_alignment = 1

[node name="DamageBar" parent="PlayerController/Hud" instance=ExtResource("11_veoik")]
unique_name_in_owner = true
offset_top = -110.0
offset_right = -10.0
offset_bottom = -10.0

[node name="RpmBar" parent="PlayerController/Hud" instance=ExtResource("12_um7jh")]
modulate = Color(1, 1, 1, 0.784314)

[node name="TimerLabel" type="RichTextLabel" parent="PlayerController/Hud"]
visible = false
offset_top = -1.0
offset_right = 640.0
offset_bottom = 212.0
theme_override_fonts/normal_font = ExtResource("7_520lm")
theme_override_font_sizes/normal_font_size = 44
bbcode_enabled = true
text = "Time"
script = SubResource("GDScript_y0cgq")

[node name="HeatBarL" parent="PlayerController/Hud" instance=ExtResource("14_qimxu")]
offset_top = -59.0
offset_bottom = 21.0
rotation = 0.785398
fill_mode = 2

[node name="HeatBarR" parent="PlayerController/Hud" instance=ExtResource("14_qimxu")]
offset_left = -56.0
offset_top = -2.0
offset_right = 24.0
offset_bottom = 78.0
rotation = -0.785398
size_flags_horizontal = 6
fill_mode = 2

[node name="AmbientTemperature" type="TextureRect" parent="PlayerController/Hud"]
self_modulate = Color(0.44, 0.44, 0.44, 1)
z_index = 1
anchors_preset = -1
anchor_top = 0.004
anchor_bottom = 0.004
offset_left = 290.0
offset_top = -19.92
offset_right = 350.0
offset_bottom = 40.08
size_flags_vertical = 0
texture = ExtResource("20_pe315")
expand_mode = 5

[node name="Frost" type="TextureRect" parent="PlayerController/Hud/AmbientTemperature"]
self_modulate = Color(0.112, 0.2, 0.163333, 0.411765)
z_index = 1
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
size_flags_vertical = 0
texture = ExtResource("14_tfebk")
expand_mode = 5

[node name="CurrentAmbientTemp" type="Label" parent="PlayerController/Hud/AmbientTemperature"]
z_index = 1
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_top = 6.0
offset_right = 5.00012
offset_bottom = 5.99985
grow_horizontal = 2
grow_vertical = 2
text = "-200°"
label_settings = SubResource("LabelSettings_w3t5d")
horizontal_alignment = 1
vertical_alignment = 1
script = ExtResource("16_renhl")

[node name="CurrentAmbientTemp2" type="Label" parent="PlayerController/Hud/AmbientTemperature/CurrentAmbientTemp"]
visible = false
z_index = 1
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 45.0
offset_top = 21.0
offset_right = -7.00016
offset_bottom = -16.9998
grow_horizontal = 2
grow_vertical = 2
text = "C"
label_settings = SubResource("LabelSettings_xnwfa")
horizontal_alignment = 2
vertical_alignment = 1

[node name="WreckedCarScreen" parent="PlayerController" instance=ExtResource("13_dwib2")]
visible = false

[node name="Heater" parent="." instance=ExtResource("27_nxxk1")]
transform = Transform3D(0.952628, 0, 0.55, 0, 1.1, 0, -0.55, 0, 0.952628, 61.592, 55.5, -550.972)
max_heat = 200

[connection signal="area_entered" from="LedNi\'ja/IcePlane/Area3D" to="LedNi\'ja/IcePlane" method="_on_area_3d_area_entered"]
[connection signal="area_exited" from="LedNi\'ja/IcePlane/Area3D" to="LedNi\'ja/IcePlane" method="_on_area_3d_area_exited"]
[connection signal="body_entered" from="LedNi\'ja/IcePlane/Area3D" to="LedNi\'ja/IcePlane" method="_on_area_3d_body_entered"]
[connection signal="body_exited" from="LedNi\'ja/IcePlane/Area3D" to="LedNi\'ja/IcePlane" method="_on_area_3d_body_exited"]
